2025-04-02 21:39:30,361 - INFO - [<module>] - Using native tf.keras.optimizers.AdamW.
2025-04-02 21:39:30,363 - INFO - [load_config] - Recalculated num_features_statistical to 187
2025-04-02 21:39:30,364 - INFO - [load_config] - Configurações carregadas e mescladas de configv4.json
2025-04-02 21:39:30,364 - INFO - [load_config] - Total features calculated: 307
2025-04-02 21:39:30,364 - INFO - [main] - Iniciando Mega-Sena V4 em 2025-04-02 21:39:30...
2025-04-02 21:39:30,365 - INFO - [load_config] - Recalculated num_features_statistical to 187
2025-04-02 21:39:30,365 - INFO - [load_config] - Configurações carregadas e mescladas de configv4.json
2025-04-02 21:39:30,365 - INFO - [load_config] - Total features calculated: 307
2025-04-02 21:39:30,365 - INFO - [validate_config] - Validando configuração V4...
2025-04-02 21:39:30,366 - INFO - [validate_config] - Configuração V4 validada.
2025-04-02 21:39:30,366 - INFO - [main] - Etapa 1: Download/Preparação Dados...
2025-04-02 21:39:30,366 - INFO - [download_and_prepare_data] - Iniciando carregamento de dados...
2025-04-02 21:39:30,366 - INFO - [download_and_prepare_data] - Carregando dados do cache...
2025-04-02 21:39:30,404 - INFO - [download_and_prepare_data] - Dados carregados com sucesso do cache.
2025-04-02 21:39:30,422 - INFO - [download_and_prepare_data] - Coluna 'Data' convertida.
2025-04-02 21:39:30,423 - INFO - [download_and_prepare_data] - Dados ordenados por 'Concurso'.
2025-04-02 21:39:30,424 - INFO - [download_and_prepare_data] - Dados processados (API/Cache): 2846 sorteios.
2025-04-02 21:39:30,424 - INFO - [download_and_prepare_data] - Colunas encontradas: ['Bola1', 'Bola2', 'Bola3', 'Bola4', 'Bola5', 'Bola6']
2025-04-02 21:39:30,426 - INFO - [download_and_prepare_data] - Colunas das bolas verificadas/convertidas.
2025-04-02 21:39:30,427 - INFO - [download_and_prepare_data] - Processamento final: 2846 sorteios.
2025-04-02 21:39:30,430 - INFO - [main] - Etapa 2: Pré-processamento Labels...
2025-04-02 21:39:30,431 - INFO - [preprocess_data_labels] - Pré-processando labels (MultiLabelBinarizer)...
2025-04-02 21:39:30,453 - INFO - [preprocess_data_labels] - Labels transformados: (2846, 60).
2025-04-02 21:39:30,454 - INFO - [main] - Etapa 3a: Cálculo Features Tempo...
2025-04-02 21:39:30,454 - INFO - [add_time_features] - Calculando features de tempo...
2025-04-02 21:39:30,482 - INFO - [add_time_features] - Features de tempo calculadas. Shape: (2846, 60)
2025-04-02 21:39:30,483 - INFO - [main] - Etapa 3b: Cálculo Features Estatísticas...
2025-04-02 21:39:30,484 - INFO - [add_statistical_features] - Calculando features estatísticas (Freq. [10, 50, 100])...
2025-04-02 21:39:30,594 - INFO - [add_statistical_features] - Features estatísticas calculadas. Shape: (2846, 187)
2025-04-02 21:39:30,595 - INFO - [main] - Etapa 4: Divisão/Escalonamento/Sequenciamento...
2025-04-02 21:39:30,596 - INFO - [split_data] - Dividindo dados, escalando features (Tempo/Estatísticas)...
2025-04-02 21:39:30,596 - INFO - [split_data] - Índices Brutos - Treino: 2056, Val: 363, Teste: 427
2025-04-02 21:39:30,598 - INFO - [split_data] - Ajustando Scalers (StandardScaler) no treino...
2025-04-02 21:39:30,606 - INFO - [split_data] - Escalando features de validação/teste...
2025-04-02 21:39:30,608 - INFO - [split_data] - Criando sequências (Treino)...
2025-04-02 21:39:30,633 - INFO - [split_data] - Criando sequências (Validação)...
2025-04-02 21:39:30,637 - INFO - [split_data] - Criando sequências (Teste)...
2025-04-02 21:39:30,643 - INFO - [split_data] - Shapes Finais: Treino X=(2036, 20, 307), Val X=(343, 20, 307), Teste X=(407, 20, 307)
2025-04-02 21:39:30,643 - INFO - [main] - Etapa 5: Construção Modelo GRU V4...
2025-04-02 21:39:30,643 - INFO - [build_model] - Construindo modelo GRU V4: units=192, dropout=0.4, batch_norm=True, attention=True (keras_additive)
2025-04-02 21:39:30,733 - INFO - [build_model] - Adding keras_additive Attention layer.
2025-04-02 21:39:30,756 - INFO - [build_model] - Using Optimizer: AdamW, Initial LR: 0.001
2025-04-02 21:39:30,757 - INFO - [build_model] - LR Schedule: CosineDecay over 10000 steps, end factor 0.01.
2025-04-02 21:39:30,759 - INFO - [build_model] - AdamW Weight Decay: 0.0001
2025-04-02 21:39:30,824 - INFO - [main] - Etapa 6: Treinamento Modelo V4...
2025-04-02 21:39:30,825 - INFO - [train_model] - Iniciando o treinamento do modelo GRU V4...
2025-04-02 21:39:31,472 - INFO - [on_epoch_begin] - Época 1 Início - LR Atual: 0.0010000
2025-04-02 21:39:31,677 - ERROR - [train_model] - Erro durante o treinamento: Arguments `target` and `output` must have the same rank (ndim). Received: target.shape=(None, 60), output.shape=(None, 20, 60)
Traceback (most recent call last):
  File "c:\dev\python\mega_sena\mega_sena_v4.py", line 542, in train_model
    history = model.fit(
  File "C:\dev\python\mega_sena\.env\lib\site-packages\keras\src\utils\traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "C:\dev\python\mega_sena\.env\lib\site-packages\keras\src\backend\tensorflow\nn.py", line 767, in binary_crossentropy
    raise ValueError(
ValueError: Arguments `target` and `output` must have the same rank (ndim). Received: target.shape=(None, 60), output.shape=(None, 20, 60)
2025-04-02 21:39:31,682 - CRITICAL - [main] - Falha Etapa 6. Abortando.
